generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model addresses {
  id          String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id     String? @db.Uuid
  street      String?
  city        String? @db.VarChar(100)
  district    String? @db.VarChar(100)
  postal_code String? @db.VarChar(20)
  lat         Float?
  lon         Float?
  users       users?  @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_addresses_user")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model availabilities {
  id             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id        String?  @db.Uuid
  available_from DateTime @db.Timestamptz(6)
  available_to   DateTime @db.Timestamptz(6)
  weekend        String[] @default([])
  users          users?   @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_avail_user")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model notifications {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String?   @db.Uuid
  title      String?
  body       String?
  is_read    Boolean?  @default(false)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  users      users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_notifications_user")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model orders {
  id                                     String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_id                              String?        @db.Uuid
  assigned_worker_id                     String?        @db.Uuid
  status                                 booking_status @default(pending)
  work_start                             DateTime?      @db.Timestamptz(6)
  work_end                               DateTime?      @db.Timestamptz(6)
  total_amount                           Decimal?       @default(0.0) @db.Decimal(12, 2)
  description                            String?
  created_at                             DateTime?      @default(now()) @db.Timestamptz(6)
  updated_at                             DateTime?      @default(now()) @db.Timestamptz(6)
  address                                String?
  selected_time                          DateTime?      @db.Timestamptz(6)
  payment_completed                      Boolean?
  cancel_reason                          String?
  canceled_by                            String?
  items_approval                         Boolean?
  is_reviewed                            Boolean?
  order_items                            order_items[]
  users_orders_assigned_worker_idTousers users?         @relation("orders_assigned_worker_idTousers", fields: [assigned_worker_id], references: [id], onUpdate: NoAction)
  users_orders_client_idTousers          users?         @relation("orders_client_idTousers", fields: [client_id], references: [id], onUpdate: NoAction)
  payments                               payments[]
  reviews                                reviews[]

  @@index([client_id], map: "idx_orders_client")
  @@index([status], map: "idx_orders_status")
  @@index([assigned_worker_id], map: "idx_orders_worker")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model payments {
  id             String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order_id       String?         @db.Uuid
  payer_id       String?         @db.Uuid
  payment_method String?         @db.VarChar(50)
  trx_id         String?         @db.VarChar(255)
  amount         Decimal         @db.Decimal(12, 2)
  status         payment_status? @default(pending)
  paid_at        DateTime?       @db.Timestamptz(6)
  created_at     DateTime?       @default(now()) @db.Timestamptz(6)
  orders         orders?         @relation(fields: [order_id], references: [id], onUpdate: NoAction)
  users          users?          @relation(fields: [payer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  refunds        refunds[]

  @@index([trx_id], map: "idx_payments_gateway_id")
  @@index([order_id], map: "idx_payments_order")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model reviews {
  id                             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order_id                       String?   @db.Uuid
  user_id                        String?   @db.Uuid
  worker_id                      String?   @db.Uuid
  rating                         Int?      @db.SmallInt
  comment                        String?
  created_at                     DateTime? @default(now()) @db.Timestamptz(6)
  orders                         orders?   @relation(fields: [order_id], references: [id], onUpdate: NoAction)
  users_reviews_user_idTousers   users?    @relation("reviews_user_idTousers", fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "reviews_reviewer_id_fkey")
  users_reviews_worker_idTousers users?    @relation("reviews_worker_idTousers", fields: [worker_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([order_id], map: "idx_reviews_order")
  @@index([worker_id], map: "idx_reviews_worker")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model service_categories {
  id               Int                @id @default(autoincrement())
  slug             String             @unique @db.VarChar(100)
  name             String             @db.VarChar(150)
  description      String?
  status           category_status    @default(active)
  service_sections service_sections[]
  worker_services  worker_services[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model spatial_ref_sys {
  srid      Int     @id
  auth_name String? @db.VarChar(256)
  auth_srid Int?
  srtext    String? @db.VarChar(2048)
  proj4text String? @db.VarChar(2048)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model users {
  id                                      String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email                                   String                   @unique @db.VarChar(255)
  phone                                   String                   @unique @db.VarChar(20)
  full_name                               String                   @db.VarChar(50)
  gender                                  gender
  date_of_birth                           DateTime                 @db.Date
  nid                                     String?                  @unique @db.VarChar(15)
  password_hash                           String
  role                                    user_role                @default(client)
  profile_picture                         String?
  created_at                              DateTime?                @default(now()) @db.Timestamptz(6)
  updated_at                              DateTime?                @default(now()) @db.Timestamptz(6)
  last_login_at                           DateTime?                @db.Timestamptz(6)
  status                                  user_status              @default(active)
  addresses                               addresses[]
  availabilities                          availabilities[]
  notifications                           notifications[]
  orders_orders_assigned_worker_idTousers orders[]                 @relation("orders_assigned_worker_idTousers")
  orders_orders_client_idTousers          orders[]                 @relation("orders_client_idTousers")
  payments                                payments[]
  reviews_reviews_user_idTousers          reviews[]                @relation("reviews_user_idTousers")
  reviews_reviews_worker_idTousers        reviews[]                @relation("reviews_worker_idTousers")
  verification_documents                  verification_documents[]
  worker_profiles                         worker_profiles?
  worker_services                         worker_services[]

  @@index([email], map: "idx_users_email")
  @@index([id], map: "idx_users_id")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model verification_documents {
  id             String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id        String?              @db.Uuid
  document_type  String?              @db.VarChar(100)
  file_url       String?
  uploaded_at    DateTime?            @default(now()) @db.Timestamptz(6)
  reviewed_at    DateTime?            @db.Timestamptz(6)
  review_comment String?
  status         verification_status? @default(pending)
  users          users?               @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_docs_user")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model worker_profiles {
  user_id          String               @id @db.Uuid
  display_name     String?              @db.VarChar(150)
  bio              String?
  years_experience Int?                 @default(0) @db.SmallInt
  avg_rating       Decimal?             @default(0.0) @db.Decimal(3, 2)
  total_reviews    Int?                 @default(0)
  verification     verification_status? @default(unverified)
  documents_count  Int?                 @default(0)
  created_at       DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?            @default(now()) @db.Timestamptz(6)
  users            users                @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([verification], map: "idx_worker_verification")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model worker_services {
  id                 String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id            String?             @db.Uuid
  category_id        Int?
  base_price         Decimal             @db.Decimal(12, 2)
  price_unit         String?             @default("hour") @db.VarChar(20)
  skills             Json?
  created_at         DateTime?           @default(now()) @db.Timestamptz(6)
  section_id         Int?
  service_categories service_categories? @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  service_sections   service_sections?   @relation(fields: [section_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users              users?              @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, category_id])
  @@index([category_id], map: "idx_worker_service_category")
  @@index([user_id], map: "idx_worker_service_user")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model service_sections {
  id                 Int                @id @default(autoincrement())
  category_id        Int
  slug               String             @db.VarChar(120)
  name               String             @db.VarChar(150)
  description        String?
  status             section_status     @default(active)
  service_categories service_categories @relation(fields: [category_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  worker_services    worker_services[]

  @@unique([category_id, slug])
}

model order_items {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  items            Json
  additional_notes String?
  verified         Boolean?  @default(false)
  created_at       DateTime? @default(now()) @db.Timestamptz(6)
  updated_at       DateTime? @default(now()) @db.Timestamptz(6)
  order_id         String    @db.Uuid
  orders           orders    @relation(fields: [order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([items], map: "idx_order_items_items", type: Gin)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model refunds {
  id            String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  payment_id    String        @db.Uuid
  trx_id        String        @db.VarChar(255)
  refund_amount Decimal       @db.Decimal(10, 2)
  refund_reason String?
  refund_ref_id String?       @db.VarChar(100)
  refund_status refund_status @default(pending)
  created_at    DateTime      @default(now()) @db.Timestamptz(6)
  updated_at    DateTime?     @db.Timestamptz(6)
  completed_at  DateTime?     @db.Timestamptz(6)
  payments      payments      @relation(fields: [payment_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_refunds_payment")

  @@index([payment_id], map: "idx_refunds_payment_id")
  @@index([refund_status], map: "idx_refunds_status")
  @@index([trx_id], map: "idx_refunds_tran_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model complaints {
  id                String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  raised_by_user_id String          @db.Uuid
  raised_by_role    String          @db.VarChar(20)
  against_user_id   String          @db.Uuid
  booking_id        String          @db.Uuid
  payment_id        String?         @db.Uuid
  category          String          @db.VarChar(50)
  sub_category      String?         @db.VarChar(50)
  priority          String?         @default("medium") @db.VarChar(20)
  subject           String          @db.VarChar(150)
  description       String
  attachments       Json?
  status            complain_status @default(open)
  admin_notes       String?
  resolution        String?
  created_at        DateTime?       @default(now()) @db.Timestamptz(6)
  updated_at        DateTime?       @default(now()) @db.Timestamptz(6)
  resolved_at       DateTime?       @db.Timestamptz(6)
}

enum booking_status {
  cart
  pending
  accepted
  in_progress
  completed
  cancelled
  awaiting
  disputed
}

enum gender {
  male
  female
  others
}

enum payment_status {
  pending
  paid
  failed
  refunded
  cancelled
}

enum user_role {
  client
  worker
  admin
}

enum verification_status {
  unverified
  pending
  verified
  rejected
}

enum user_status {
  active
  inactive
  suspended
}

enum category_status {
  active
  inactive
  disabled
}

enum section_status {
  active
  inactive
  disabled
}

enum refund_status {
  pending
  processing
  success
  failed
}

enum complain_status {
  open
  under_review
  resolved
  rejected
  closed
}
